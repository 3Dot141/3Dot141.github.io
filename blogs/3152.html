<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
































<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-medium-self.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-small-self.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="最近一场面试，面试官问了我 对称加密与非对称加密的问题，虽然曾经看过一些内容，但是没有系统的整理，所以当被问的时候，脑子里一片空白，没有回答上来。因此，在这里重新梳理一下密码学的知识点，夯实一下基础。">
<meta name="keywords" content="killBase">
<meta property="og:type" content="article">
<meta property="og:title" content="killBase系列 -- 密码学">
<meta property="og:url" content="https://3dot141.com/blogs/3152.html">
<meta property="og:site_name" content="killCode">
<meta property="og:description" content="最近一场面试，面试官问了我 对称加密与非对称加密的问题，虽然曾经看过一些内容，但是没有系统的整理，所以当被问的时候，脑子里一片空白，没有回答上来。因此，在这里重新梳理一下密码学的知识点，夯实一下基础。">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://ovmspkp0s.bkt.clouddn.com/201710171653_195.png">
<meta property="og:image" content="http://ovmspkp0s.bkt.clouddn.com/201711110701_362.png">
<meta property="og:image" content="http://ovmspkp0s.bkt.clouddn.com/201711110709_795.png">
<meta property="og:image" content="http://ovmspkp0s.bkt.clouddn.com/201711110713_718.png">
<meta property="og:image" content="http://ovmspkp0s.bkt.clouddn.com/201711101750_461.png">
<meta property="og:image" content="http://ovmspkp0s.bkt.clouddn.com/201711101754_590.png">
<meta property="og:image" content="http://ovmspkp0s.bkt.clouddn.com/201711101753_329.png">
<meta property="og:updated_time" content="2018-04-05T14:17:34.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="killBase系列 -- 密码学">
<meta name="twitter:description" content="最近一场面试，面试官问了我 对称加密与非对称加密的问题，虽然曾经看过一些内容，但是没有系统的整理，所以当被问的时候，脑子里一片空白，没有回答上来。因此，在这里重新梳理一下密码学的知识点，夯实一下基础。">
<meta name="twitter:image" content="http://ovmspkp0s.bkt.clouddn.com/201710171653_195.png">






  <link rel="canonical" href="https://3dot141.com/blogs/3152.html">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>killBase系列 -- 密码学 | killCode</title>
  












  <noscript>
  <style>
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion .logo-line-before i { left: initial; }
    .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">killCode</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags<span class="badge">12</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-code">

    
    
    
      
    

    
      
    

    <a href="/categories/Code" rel="section"><i class="menu-item-icon fa fa-fw fa-code"></i> <br>code</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-live">

    
    
    
      
    

    
      
    

    <a href="/categories/Live" rel="section"><i class="menu-item-icon fa fa-fw fa-superscript"></i> <br>live</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-essay">

    
    
    
      
    

    
      
    

    <a href="/categories/Essay" rel="section"><i class="menu-item-icon fa fa-fw fa-coffee"></i> <br>essay</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://3dot141.com/blogs/3152.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="3Dot141">
      <meta itemprop="description" content="Nothing is impossible to a willing heart.">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killCode">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">killBase系列 -- 密码学

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-11-11 00:00:00" itemprop="dateCreated datePublished" datetime="2017-11-11T00:00:00+08:00">2017-11-11</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-04-05 22:17:34" itemprop="dateModified" datetime="2018-04-05T22:17:34+08:00">2018-04-05</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Code/" itemprop="url" rel="index"><span itemprop="name">Code</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/blogs/3152.html#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments: </span> <span class="post-comments-count valine-comment-count" data-xid="/blogs/3152.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/blogs/3152.html" class="leancloud_visitors" data-flag-title="killBase系列 -- 密码学">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views: </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count: </span>
                
                <span title="Words count">29k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">One coffee &asymp;</span>
                
                <span title="One coffee">48 mins.</span>
              
            </div>
          

          
              <div class="post-description">最近一场面试，面试官问了我 对称加密与非对称加密的问题，虽然曾经看过一些内容，但是没有系统的整理，所以当被问的时候，脑子里一片空白，没有回答上来。因此，在这里重新梳理一下密码学的知识点，夯实一下基础。</div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="密码学"><a href="#密码学" class="headerlink" title="密码学"></a>密码学</h2><h3 id="一、基础"><a href="#一、基础" class="headerlink" title="一、基础"></a>一、基础</h3><ol>
<li>密码学算法分类：<ul>
<li>消息编码：Base64 </li>
<li>消息摘要：MD类， SHA类，MAC</li>
<li>对称密码：DES,3DES,AES</li>
<li>非对称密码：RSA,DH</li>
<li>数字签名：RSASignature,DSASignature</li>
</ul>
</li>
<li>五元组<br>1)明文：原始信息。<br>2)加密算法：以密钥为参数，对明文进行多种置换和转换的规则和步骤，变换结果为密文。<br>3)解密算法：加密算法的逆变换，以密文为输入、密钥为参数，变换结果为明文。:<br>4)密钥：加密与解密算法的参数，直接影响对明文进行变换的结果。<br>5)密文：对明文进行变换的结果。</li>
<li>Java编程中常用类 – java.security 包<ol>
<li>消息编码：BASE64Encoder,BASE64Decoder – java.util</li>
<li>消息摘要：MessageDigest</li>
<li>对称密码：KeyGenerator,SeretkeyFactory – javax.crypto 包<strong>(提供给AES，DES，3DES，MD5，SHA1等 对称 和 单向加密算法。)</strong>,Cipher </li>
<li>非对称密码：KeyPairGenerator,KeyFactory – java.security 包<strong>(提供给DSA，RSA， EC等 非对称加密算法。)</strong>,KeyPair,PublicKey,PrivateKey,Cipher </li>
<li>数字重命名：Signature</li>
</ol>
</li>
<li>常用开源工具<ul>
<li>Commons.Codec </li>
<li>Bouncy.Castle</li>
</ul>
</li>
</ol>
<h3 id="二、Base64-算法"><a href="#二、Base64-算法" class="headerlink" title="二、Base64 算法"></a>二、Base64 算法</h3><ol>
<li>Base64 基于64个字符编码算法，以任意 8 位字节序列组合描述形式 , BASE加密后产生的字节位数是8的倍数，如果不够位数以=符号填充。对此 Base64 算法有一套字符映射表。</li>
<li>使用方法：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取</span></span><br><span class="line">    Base64.Encoder encoder = Base64.getEncoder();</span><br><span class="line">    Base64.Decoder decoder = Base64.getDecoder();</span><br><span class="line"><span class="comment">// 加密</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] encode(<span class="keyword">byte</span>[] src);</span><br><span class="line">    * <span class="meta">@param</span>   src</span><br><span class="line">    *          the <span class="keyword">byte</span> array to encode</span><br><span class="line">    * <span class="meta">@param</span>   dst</span><br><span class="line">    *          the output <span class="keyword">byte</span> array</span><br><span class="line">    * <span class="meta">@return</span>  The number of bytes written to the output <span class="keyword">byte</span> array</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">encode</span><span class="params">(<span class="keyword">byte</span>[] src,<span class="keyword">byte</span>[] dst)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">encodeToString</span><span class="params">(<span class="keyword">byte</span>[] src)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ByteBuffer <span class="title">encode</span><span class="params">(ButeBuffer buffer)</span></span>;</span><br><span class="line"><span class="comment">// 解密</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] decode(<span class="keyword">byte</span>[] src);</span><br><span class="line">    * <span class="meta">@param</span>   src</span><br><span class="line">    *          the <span class="keyword">byte</span> array to encode</span><br><span class="line">    * <span class="meta">@param</span>   dst</span><br><span class="line">    *          the output <span class="keyword">byte</span> array</span><br><span class="line">    * <span class="meta">@return</span>  The number of bytes written to the output <span class="keyword">byte</span> array</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">decode</span><span class="params">(<span class="keyword">byte</span>[] src,<span class="keyword">byte</span>[] dst)</span></span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] decode(String src);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ByteBuffer <span class="title">decode</span><span class="params">(ButeBuffer buffer)</span></span>;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="三、消息摘要"><a href="#三、消息摘要" class="headerlink" title="三、消息摘要"></a>三、消息摘要</h3><ol>
<li>介绍：又称为 哈希算法。唯一对应一个消息或文体固定长度值，由一个单向的Hash加密函数对消息进行作用而产生。</li>
<li>分类： MD(Message Digest) 消息摘要算法，SHA(Secure Hash Algorithm) 安全散列算法， MAC(Message Authentication Code):消息认证算法</li>
<li>主要方法：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// xxx 可以为 md5,sha</span></span><br><span class="line">MessageDigest.getInstance(<span class="string">"xxx"</span>)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="1-MD5算法"><a href="#1-MD5算法" class="headerlink" title="1. MD5算法"></a>1. MD5算法</h4><blockquote>
<p>原理：<br>首先需要对信息进行填充，使其位长对512求余的结果等于448。<br>因此，信息的位长（Bits Length）将被扩展至N<em>512+448，N为一个非负整数，N可以是零。<br>填充的方法如下，在信息的后面填充一个1和无数个0，直到满足上面的条件时才停止用0对信息的填充。<br>然后，在这个结果后面附加一个以64位二进制表示的填充前信息长度。<br>经过这两步的处理，信息的位长=N</em>512+448+64=(N+1）*512，即长度恰好是512的整数倍<br>MD5以512位分组来处理输入的信息，且每一分组又被划分为16个32位子分组，经过了一系列的处理后，算法的输出由四个32位分组组成，将这四个32位分组级联后将生成一个128位散列值。</p>
</blockquote>
<p>代码实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MD5Util</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*** </span></span><br><span class="line"><span class="comment">     * MD5加密 生成32位md5码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> 待加密字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回32位md5码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">md5Encode</span><span class="params">(String inStr)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        MessageDigest md5 = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            md5 = MessageDigest.getInstance(<span class="string">"MD5"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(e.toString());</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] byteArray = inStr.getBytes(<span class="string">"UTF-8"</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] md5Bytes = md5.digest(byteArray);</span><br><span class="line">        StringBuffer hexValue = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="comment">// 转化为 16 进制</span></span><br><span class="line">        <span class="comment">// 原理 ： byte 为 8 字节。 0xff --&gt; 11111111</span></span><br><span class="line">        <span class="comment">// byte&amp;0xff 如果小于16 则小于00010000 </span></span><br><span class="line">        <span class="comment">// 所以由 toHexString() 只能转化为 1 位，所以要在前面加上 ‘0’。再加上实际的值。</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; md5Bytes.length; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> val = ((<span class="keyword">int</span>) md5Bytes[i]) &amp; <span class="number">0xff</span>;</span><br><span class="line">            <span class="keyword">if</span> (val &lt; <span class="number">16</span>) &#123;</span><br><span class="line">                hexValue.append(<span class="string">"0"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            hexValue.append(Integer.toHexString(val));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hexValue.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-SHA-算法"><a href="#2-SHA-算法" class="headerlink" title="2. SHA 算法"></a>2. SHA 算法</h4><blockquote>
<p>原理：接收一段明文，然后以一种不可逆的方式将它转换成一段（通常更小）密文，也可以简单的理解为取一串输入码（称为预映射或信息），并把它们转化为长度较短、位数固定的输出序列即散列值（也称为信息摘要或信息认证代码）的过程。</p>
<p>特点：该算法输入报文的长度不限，产生的输出是一个<strong>160位</strong>的报文摘要。输入是按 512 位的分组进行处理的。</p>
</blockquote>
<blockquote>
<p>作用：通过散列算法可实现数字签名实现，数字签名的原理是将要传送的明文通过一种函数运算（Hash）转换成报文摘要（不同的明文对应不同的报文摘要），报文摘要加密后与明文一起传送给接受方，接受方将接受的明文产生新的报文摘要与发送方的发来报文摘要解密比较，比较结果一致表示明文未被改动，如果不一致表示明文已被篡改。</p>
</blockquote>
<p>代码实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SHAUtil</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*** </span></span><br><span class="line"><span class="comment">     * SHA加密 生成40位SHA码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> 待加密字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回40位SHA码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">shaEncode</span><span class="params">(String inStr)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        MessageDigest sha = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sha = MessageDigest.getInstance(<span class="string">"SHA"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(e.toString());</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] byteArray = inStr.getBytes(<span class="string">"UTF-8"</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] md5Bytes = sha.digest(byteArray);</span><br><span class="line">        StringBuffer hexValue = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; md5Bytes.length; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> val = ((<span class="keyword">int</span>) md5Bytes[i]) &amp; <span class="number">0xff</span>;</span><br><span class="line">            <span class="keyword">if</span> (val &lt; <span class="number">16</span>) &#123; </span><br><span class="line">                hexValue.append(<span class="string">"0"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            hexValue.append(Integer.toHexString(val));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hexValue.toString();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-HMAC-算法"><a href="#3-HMAC-算法" class="headerlink" title="3. HMAC 算法"></a>3. HMAC 算法</h4><blockquote>
<p>原理:用公开函数和密钥产生一个固定长度的值作为认证标识，用这个 标识鉴别消息的完整性。使用一个密钥生成一个固定大小的小数据块，即MAC，并将其加入到消息中，然后传输。接收方利用与发送方共享的密钥进行鉴别认证 等。</p>
</blockquote>
<p>代码实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 构建密钥</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] getSecretKey()&#123;</span><br><span class="line">        <span class="comment">// 初始化</span></span><br><span class="line">        KeyGenerator keyGen = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">                keyGen = KeyGenerator.getInstance(<span class="string">"HmacMD5"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e1) &#123;</span><br><span class="line">                e1.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 产生密钥</span></span><br><span class="line">        SecretKey secretKey1 = keyGen.generateKey();</span><br><span class="line">        <span class="comment">// 得到密钥字节数组</span></span><br><span class="line">        <span class="keyword">byte</span>[] key = secretKey1.getEncoded();</span><br><span class="line">        <span class="keyword">return</span> key;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 执行消息摘要</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">doHMAC</span><span class="params">(<span class="keyword">byte</span>[] data,String key)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 从字节数组还原</span></span><br><span class="line">        SecretKey secretKey2 = <span class="keyword">new</span> SecretKeySpec(key,<span class="string">"HmacMD5"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 实例化 Mac</span></span><br><span class="line">                Mac mac = Mac.getInstance(<span class="string">"HmacMD5"</span>);</span><br><span class="line">                <span class="comment">// 密钥初始化 Mac</span></span><br><span class="line">                mac.init(secretKey2);</span><br><span class="line">                <span class="comment">// 执行消息摘要</span></span><br><span class="line">                <span class="keyword">byte</span>[] result = mac.doFinal(data);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvalidKeyException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-SHA-与-MD5比较"><a href="#4-SHA-与-MD5比较" class="headerlink" title="4. SHA 与 MD5比较"></a>4. SHA 与 MD5比较</h4><p>1）对强行攻击的安全性：最显著和最重要的区别是SHA-1摘要比MD5摘要长32 位。使用强行技术，产生任何一个报文使其摘要等于给定报摘要的难度对MD5是2^128数量级的操作，而对SHA-1则是2^160数量级的操作。这样，SHA-1对强行攻击有更大的强度。<br>2）对密码分析的安全性：由于MD5的设计，易受密码分析的攻击，SHA-1显得不易受这样的攻击。<br>3）速度：在相同的硬件上，SHA-1的运行速度比MD5慢。</p>
<h3 id="四、对称加密"><a href="#四、对称加密" class="headerlink" title="四、对称加密"></a>四、对称加密</h3><ol>
<li><p>定义：在对称加密算法中，数据发信方将明文（原始数据）和加密密钥（mi yue）一起经过特殊加密算法处理后，使其变成复杂的加密密文发送出去。<br>收信方收到密文后，若想解读原文，则需要使用加密用过的<strong>密钥</strong>及<strong>相同算法</strong>的<strong>逆算法</strong>对密文进行解密，才能使其恢复成可读明文。<br>在对称加密算法中，使用的<strong>密钥</strong>只有<strong>一个</strong>，发收信双方都使用这个密钥对数据进行加密和解密，这就要求解密方事先必须知道加密密钥。</p>
</li>
<li><p>优缺点         </p>
<ul>
<li>优点：算法公开、计算量小、加密速度快、加密效率高。</li>
<li>缺点：<br>（1）交易双方都使用同样钥匙，安全性得不到保证。<br>（2）每对用户每次使用对称加密算法时，都需要使用其他人不知道的惟一钥匙，这会使得发收信双方所拥有的钥匙数量呈几何级数增长，<br><strong>密钥管理</strong>成为用户的负担。对称加密算法在分布式网络系统上使用较为困难，主要是因为密钥管理困难，使用成本较高。</li>
</ul>
</li>
<li>常用的对称加密算法。<br>DES（Data Encryption Standard）：数据加密标准，速度较快，适用于加密大量数据的场合。<br>3DES（Triple DES）：是基于DES，对一块数据用三个不同的密钥进行三次加密，强度更高。<br>AES（Advanced Encryption Standard）：高级加密标准，是下一代的加密算法标准，速度快，安全级别最高</li>
<li>对称密码常用的数学运算<ul>
<li>移位和循环移位<br>　　移位就是将一段数码按照规定的位数整体性地左移或右移。循环右移就是当右移时，把数码的最后的位移到数码的最前头，循环左移正相反。例如，对十进制数码12345678循环右移1位（十进制位）的结果为81234567，而循环左移1位的结果则为23456781。</li>
<li>置换<br>　　就是将数码中的某一位的值根据置换表的规定，用另一位代替。它不像移位操作那样整齐有序，看上去杂乱无章。这正是加密所需,被经常应用。</li>
<li>扩展<br>　　就是将一段数码扩展成比原来位数更长的数码。扩展方法有多种,例如,可以用置换的方法，以扩展置换表来规定扩展后的数码每一位的替代值。</li>
<li>压缩<br>　　就是将一段数码压缩成比原来位数更短的数码。压缩方法有多种，例如，也可以用置换的方法，以表来规定压缩后的数码每一位的替代值。</li>
<li>异或<br>　　这是一种二进制布尔代数运算。异或的数学符号为⊕ ，它的运算法则如下：<br>1⊕ 1 = 0<br>0⊕ 0 = 0<br>1⊕ 0 = 1<br>0⊕ 1 = 1<br>　　也可以简单地理解为，参与异或运算的两数位如相等，则结果为0，不等则为1。</li>
<li>迭代<br>　　迭代就是多次重复相同的运算，这在密码算法中经常使用，以使得形成的密文更加难以破解。</li>
</ul>
</li>
<li>分组加密<br>参考 <a href="http://blog.csdn.net/fw0124/article/details/8472560" target="_blank" rel="noopener">分组加密的四种模式</a><br><a href="http://www.cnblogs.com/dacainiao/p/5521646.html" target="_blank" rel="noopener">ECB模式</a> – 电子密码本模式<br><a href="http://www.cnblogs.com/dacainiao/p/5521866.html" target="_blank" rel="noopener">CBC模式</a> – 密码分组链接模式<br><a href="http://www.cnblogs.com/dacainiao/p/5521930.html" target="_blank" rel="noopener">CFB模式</a> – 密文反馈模式<br><a href="http://www.cnblogs.com/dacainiao/p/5525364.html" target="_blank" rel="noopener">OFB模式</a> – 输出反馈模式<br><a href="http://www.cnblogs.com/dacainiao/p/5525410.html" target="_blank" rel="noopener">CTR模式</a> – 计数器模式</li>
<li>常用的填充方式<br>在Java进行DES、3DES和AES三种对称加密算法时，常采用的是NoPadding（不填充）、Zeros填充（0填充）、PKCS5Padding填充。</li>
</ol>
<ul>
<li>ZerosPadding<blockquote>
<p>全部填充为0的字节，结果如下：<br>  F1 F2 F3 F4 F5 F6 F7 F8   //第一块<br>  F9 00 00 00 00 00 00 00 //第二块</p>
</blockquote>
</li>
<li>PKCS5Padding<blockquote>
<p>每个填充的字节都记录了填充的总字节数，结果如下：<br>  F1 F2 F3 F4 F5 F6 F7 F8   //第一块<br>  F9 07 07 07 07 07 07 07 //第二块<br>注： 如果</p>
</blockquote>
</li>
</ul>
<h4 id="1-DES-Data-Encryption-Standard"><a href="#1-DES-Data-Encryption-Standard" class="headerlink" title="1. DES(Data Encryption Standard)"></a>1. DES(Data Encryption Standard)</h4><h5 id="1、-介绍："><a href="#1、-介绍：" class="headerlink" title="1、 介绍："></a>1、 介绍：</h5><p>DES算法的入口参数有三个：<strong>Key、Data、Mode</strong>。<br><strong>Key</strong>为8个字节共64位，其中<strong>密钥 56 位，校验位 8 位(每组的 第8位都被用作奇偶校验)</strong>，是DES算法的工作密钥；<br><strong>Data</strong>也为8个字节64位，是要被加密或被解密的数据；<br><strong>Mode</strong>为DES的工作方式,有两种：加密或解密。</p>
<h5 id="2、-加密过程："><a href="#2、-加密过程：" class="headerlink" title="2、 加密过程："></a>2、 加密过程：</h5><p><strong>简略版:</strong></p>
<ul>
<li>首先要生成一套加密密钥，从用户处取得一个64位长的密码口令，然后通过等分、移位、选取和迭代形成一套16个加密密钥，分别供每一轮运算中使用。<br> 过程 1，2</li>
<li>DES对64位(bit)的明文分组M进行操作，M经过一个初始置换IP，置换成m0。将m0明文分成左半部分和右半部分m0 = (L0，R0)，各32位长。然后进行16轮完全相同的运算（迭代），这些运算被称为函数f，在每一轮运算过程中数据与相应的密钥结合。<br> 过程 4</li>
<li>在每一轮中，密钥位移位，然后再从密钥的56位中选出48位。通过一个扩展置换将数据的右半部分<strong>扩展</strong>成48位，并通过一个异或操作替代成新的48位数据，再将其<strong>压缩置换</strong>成32位。这四步运算构成了函数f。然后，通过另一个异或运算，函数f的输出与左半部分结合，其结果成为新的右半部分，原来的右半部分成为新的左半部分。将该操作重复16次。<br> 过程 3 ，5 ，6 ，7 ， 8 ， 9</li>
<li>经过16轮迭代后，左，右半部分合在一起经过一个逆置换（数据整理），恢复原先的顺序，这样就完成了加密过程。<br> 过程 10.</li>
</ul>
<p>详细版请见 <strong>附录</strong></p>
<h5 id="3、-解密过程"><a href="#3、-解密过程" class="headerlink" title="3、 解密过程"></a>3、 解密过程</h5><p>　　加密和解密使用相同的算法！<br>　　DES加密和解密唯一的不同是密钥的次序相反。如果各轮加密密钥分别是K1，K2，K3…K16，那么解密密钥就是K16，K15，K14…K1。这也就是DES被称为对称算法的理由吧。</p>
<h5 id="4、流程如图："><a href="#4、流程如图：" class="headerlink" title="4、流程如图："></a>4、流程如图：</h5><p><img src="http://ovmspkp0s.bkt.clouddn.com/201710171653_195.png" alt=""></p>
<h5 id="5、注意："><a href="#5、注意：" class="headerlink" title="5、注意："></a>5、注意：</h5><p>DES算法中只用到64位密钥中的其中56位，而第8、16、24、……64位8个位并未参与DES运算</p>
<h5 id="6、3DES"><a href="#6、3DES" class="headerlink" title="6、3DES"></a>6、3DES</h5><p>3DES（或称为Triple DES）</p>
<blockquote>
<p>原理：<br>    使用3条56位的密钥对 数据进行三次加密。</p>
</blockquote>
<h5 id="7、Java-实现"><a href="#7、Java-实现" class="headerlink" title="7、Java 实现"></a>7、Java 实现</h5><p><strong>相关的类</strong>：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生成密钥</span></span><br><span class="line">KeyGenerator,SecretKeyFactory</span><br><span class="line"><span class="comment">// 密钥</span></span><br><span class="line">SecretKey , SecretKeySpec</span><br><span class="line"><span class="comment">// 密码</span></span><br><span class="line">Cipher</span><br></pre></td></tr></table></figure></p>
<p><strong>这里重点讲一下 Cipher 类</strong></p>
<ol>
<li>首先要设置参数<br>Cipher.getInstance(加解密算法，加解密模式，填充模式)</li>
<li>初始化<br>Cipher.init(加解密模式 – Cypher.ENCRIPT/DECRYPT，密钥）</li>
<li>完成加解密<br>Cipher.doFinal(bytes) – 将bytes 内容 加密/解密 然后返回。</li>
</ol>
<p>这里使用 <strong>SecretKeyFactory</strong>的密钥     选择CBC模式     进行加解密。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DESCryptography</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub  </span></span><br><span class="line">          </span><br><span class="line">        String content=<span class="string">"aaaaaaaabbbbbbbbaaaaaaaa"</span>;  </span><br><span class="line">        String key=<span class="string">"01234567"</span>;  </span><br><span class="line">      </span><br><span class="line">        System.out.println(<span class="string">"加密前："</span>+byteToHexString(content.getBytes()));  </span><br><span class="line">        <span class="keyword">byte</span>[] encrypted=DES_CBC_Encrypt(content.getBytes(), key.getBytes());  </span><br><span class="line">        System.out.println(<span class="string">"加密后："</span>+byteToHexString(encrypted));  </span><br><span class="line">        <span class="keyword">byte</span>[] decrypted=DES_CBC_Decrypt(encrypted, key.getBytes());  </span><br><span class="line">        System.out.println(<span class="string">"解密后："</span>+byteToHexString(decrypted));  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] DES_CBC_Encrypt(<span class="keyword">byte</span>[] content, <span class="keyword">byte</span>[] keyBytes)&#123;        </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            DESKeySpec keySpec=<span class="keyword">new</span> DESKeySpec(keyBytes);  </span><br><span class="line">            SecretKeyFactory keyFactory=SecretKeyFactory.getInstance(<span class="string">"DES"</span>);              </span><br><span class="line">            SecretKey key=keyFactory.generateSecret(keySpec);         </span><br><span class="line">              </span><br><span class="line">            Cipher cipher=Cipher.getInstance(<span class="string">"DES/CBC/PKCS5Padding"</span>);  </span><br><span class="line">            cipher.init(Cipher.ENCRYPT_MODE, key, <span class="keyword">new</span> IvParameterSpec(keySpec.getKey()));             </span><br><span class="line">            <span class="keyword">byte</span>[] result=cipher.doFinal(content);  </span><br><span class="line">            <span class="keyword">return</span> result;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block  </span></span><br><span class="line">            System.out.println(<span class="string">"exception:"</span>+e.toString());  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] DES_CBC_Decrypt(<span class="keyword">byte</span>[] content, <span class="keyword">byte</span>[] keyBytes)&#123;        </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            DESKeySpec keySpec=<span class="keyword">new</span> DESKeySpec(keyBytes);  </span><br><span class="line">            SecretKeyFactory keyFactory=SecretKeyFactory.getInstance(<span class="string">"DES"</span>);  </span><br><span class="line">            SecretKey key=keyFactory.generateSecret(keySpec);  </span><br><span class="line">              </span><br><span class="line">            Cipher cipher=Cipher.getInstance(<span class="string">"DES/CBC/PKCS5Padding"</span>);  </span><br><span class="line">            cipher.init(Cipher.DECRYPT_MODE, key, <span class="keyword">new</span> IvParameterSpec(keyBytes));  </span><br><span class="line">            <span class="keyword">byte</span>[] result=cipher.doFinal(content);  </span><br><span class="line">            <span class="keyword">return</span> result;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block  </span></span><br><span class="line">            System.out.println(<span class="string">"exception:"</span>+e.toString());  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">byteToHexString</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> </span>&#123;  </span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer(bytes.length);  </span><br><span class="line">        String sTemp;  </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; bytes.length; i++) &#123;  </span><br><span class="line">            sTemp = Integer.toHexString(<span class="number">0xFF</span> &amp; bytes[i]);  </span><br><span class="line">            <span class="keyword">if</span> (sTemp.length() &lt; <span class="number">2</span>)  </span><br><span class="line">                sb.append(<span class="number">0</span>);  </span><br><span class="line">            sb.append(sTemp.toUpperCase());  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> sb.toString();  </span><br><span class="line">    &#125;  </span><br><span class="line">        </span><br><span class="line">     <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">byte</span> <span class="title">toByte</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">byte</span> b = (<span class="keyword">byte</span>) <span class="string">"0123456789ABCDEF"</span>.indexOf(c);  </span><br><span class="line">        <span class="keyword">return</span> b;  </span><br><span class="line">     &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="2-AES-Advanced-Encryption-Standard"><a href="#2-AES-Advanced-Encryption-Standard" class="headerlink" title="2. AES(Advanced  Encryption Standard)"></a>2. AES(Advanced  Encryption Standard)</h4><p>有时间 再写。。。 看了一天的 加密 ，累死。。。</p>
<h3 id="五、非对称加密"><a href="#五、非对称加密" class="headerlink" title="五、非对称加密"></a>五、非对称加密</h3><h4 id="1-基础"><a href="#1-基础" class="headerlink" title="1. 基础"></a>1. 基础</h4><p><strong>定义：</strong>需要两个密钥，一个是公开密钥，另一个是私有密钥；一个用作加密的时候，另一个则用作解密。<br>使用其中一个密钥把明文加密后所得的密文，只能用相对应的另一个密钥才能解密得到原本的明文；甚至连最初用来加密的密钥也不能用作解密。<br><strong>由于加密和解密需要两个不同的密钥，故被称为非对称加密</strong></p>
<p><strong>数论知识：</strong></p>
<blockquote>
<p>非对称加密运用了一部分数论知识，有兴趣的自己去看下。。。 这里提供一下链接。<br><a href="http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html" target="_blank" rel="noopener">阮一峰大神写了一部分，可以帮助理解</a></p>
</blockquote>
<p>一、互质关系：</p>
<blockquote>
<p>如果两个正整数，除了1以外，没有其他公因子，我们就称这两个数是互质关系（coprime）。比如，15和32没有公因子，所以它们是互质关系。这说明，不是质数也可以构成互质关系。<br>二、<a href="https://zh.wikipedia.org/wiki/%E6%AC%A7%E6%8B%89%E5%87%BD%E6%95%B0" target="_blank" rel="noopener">欧拉函数</a><br>三、<a href="https://zh.wikipedia.org/wiki/欧拉定理_(数论" target="_blank" rel="noopener">欧拉定理</a>)<br>四、<a href="https://zh.wikipedia.org/wiki/%E6%A8%A1%E5%8F%8D%E5%85%83%E7%B4%A0" target="_blank" rel="noopener">模反元素(模逆元)</a><br>五、<a href="https://zh.wikipedia.org/wiki/%E6%89%A9%E5%B1%95%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E7%AE%97%E6%B3%95" target="_blank" rel="noopener">扩展欧几里得算法</a></p>
</blockquote>
<h4 id="2-RSA-算法"><a href="#2-RSA-算法" class="headerlink" title="2. RSA 算法"></a>2. RSA 算法</h4><h5 id="2-1-过程"><a href="#2-1-过程" class="headerlink" title="2.1 过程"></a>2.1 过程</h5><ol>
<li>随机选择两个不相等的质数 p 和 q<br> p = 61, q = 53 </li>
<li>计算 p 和 q 的乘积 n<br> n = 61*53 = 3233</li>
<li>计算 n 的欧拉函数 φ(n)<br> φ(n) = (p-1)(q-1) = 60 * 52 = 3120</li>
<li>随机选择一个整数 e ， 条件是 1 <em>&lt;</em>  e  <em>&lt;</em> φ(n) , 且 e 与 φ(n) 互质<br> e = 17 ( 实际应用中，常常选择 65537 )</li>
<li><p>计算 e 对于 φ(n) 的模反元素 d</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">所谓<span class="string">"模反元素"</span>就是指有一个整数d，可以使得ed被φ(n)除的余数为<span class="number">1</span>。</span><br><span class="line">　　ed ≡ <span class="number">1</span> (mod φ(n))</span><br><span class="line">这个式子等价于</span><br><span class="line">　　ed - <span class="number">1</span> = kφ(n)</span><br><span class="line">于是，找到模反元素d，实质上就是对下面这个二元一次方程求解。</span><br><span class="line">　　ex + φ(n)y = <span class="number">1</span></span><br><span class="line">已知 e=<span class="number">17</span>, φ(n)=<span class="number">3120</span>，</span><br><span class="line">　　<span class="number">17</span>x + <span class="number">3120</span>y = <span class="number">1</span></span><br><span class="line">这个方程可以用<span class="string">"扩展欧几里得算法"</span>求解，此处省略具体过程。总之，爱丽丝算出一组整数解为 (x,y)=(<span class="number">2753</span>,-<span class="number">15</span>)，即 d=<span class="number">2753</span>。</span><br><span class="line">至此所有计算完成。</span><br></pre></td></tr></table></figure>
</li>
<li><p>将 n 和 e 封装成公钥， n 和 d 封装成私钥<br> 公钥 (3233,17), 私钥 (3233，2753)</p>
</li>
<li>加密与解密<ul>
<li>加密用 (n , e)<br>  加密信息 – <strong>明文</strong>为 m , <strong>m 小于 n</strong><br>  $m^e$ ≡ c (mod n)<br>  公钥是 (3233，17), m 假设为 65<br>  $65^{17}$ ≡ 2790(mod 3233)<br>  所以 c = 2790</li>
<li>解密用 (n , d)<br>  <strong>密文</strong> 为 c<br>  $c^d$ ≡ m(mod n)<br>  $2790^{2753}$ ≡ 65 (mod 3233)<br>  所以 m = 65</li>
</ul>
</li>
<li>私钥解密的证明 – 有兴趣的同学自己去找资料看下,也是数论的知识。        </li>
</ol>
<h5 id="2-2-RSA-算法的可靠性-与-破解"><a href="#2-2-RSA-算法的可靠性-与-破解" class="headerlink" title="2.2 RSA 算法的可靠性 与 破解"></a>2.2 RSA 算法的可靠性 与 破解</h5><p>以上密钥的生成步骤，出现了六个数字</p>
<blockquote>
<p> p, q, n, φ(n), e, d<br>公钥为 n, e<br>如果想要得到 d，需要进行以下逆推<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">　　（1）ed≡1 (mod φ(n))。只有知道e和φ(n)，才能算出d。</span><br><span class="line">　　（2）φ(n)=(p-1)(q-1)。只有知道p和q，才能算出φ(n)。</span><br><span class="line">　　（3）n=pq。只有将n因数分解，才能算出p和q。</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>所以 如果将 n 进行 <strong>因数分解</strong>，就意味着私钥被破解。 可是，大整数的因数分解，是一件非常困难的事情。目前，除了暴力破解，还没有发现别的有效方法。</p>
<p><strong> 注意:</strong>这里说大整数，不是 像上文 3233 这样的数字，历史上最大的已经进行因数分解的整数为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">　　12301866845301177551304949</span><br><span class="line">　　58384962720772853569595334</span><br><span class="line">　　79219732245215172640050726</span><br><span class="line">　　36575187452021997864693899</span><br><span class="line">　　56474942774063845925192557</span><br><span class="line">　　32630345373154826850791702</span><br><span class="line">　　61221429134616704292143116</span><br><span class="line">　　02221240479274737794080665</span><br><span class="line">　　351419597459856902143413</span><br></pre></td></tr></table></figure></p>
<p>它等于这样两个质数的乘积<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">　　33478071698956898786044169</span><br><span class="line">　　84821269081770479498371376</span><br><span class="line">　　85689124313889828837938780</span><br><span class="line">　　02287614711652531743087737</span><br><span class="line">　　814467999489</span><br><span class="line">　　　　×</span><br><span class="line">　　36746043666799590428244633</span><br><span class="line">　　79962795263227915816434308</span><br><span class="line">　　76426760322838157396665112</span><br><span class="line">　　79233373417143396810270092</span><br><span class="line">　　798736308917</span><br></pre></td></tr></table></figure></p>
<p><strong>破解：</strong> 这里有一篇关于 RSA 破解的文章，有兴趣的同学可以看一下。<br><a href="https://juejin.im/post/5937e8252f301e006b2c4e84" target="_blank" rel="noopener">RSA计时攻击</a></p>
<h5 id="2-3-Java-实现"><a href="#2-3-Java-实现" class="headerlink" title="2.3 Java 实现"></a>2.3 Java 实现</h5><p><strong>使用到的类</strong>： java.security<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生成 公钥，密钥</span></span><br><span class="line">KeyPairGenerator --&gt; KeyPair  , KeyFactory --&gt; RSA XXX Spec</span><br><span class="line"><span class="comment">// 公钥 密钥</span></span><br><span class="line">KeyPair</span><br><span class="line">RSAPublicKeySpec --&gt; RSAPublicKey</span><br><span class="line">RSAPrivateKeySpec --&gt; RSAPrivateKey</span><br><span class="line"><span class="comment">// 密码</span></span><br><span class="line">Cipher  --  <span class="number">1</span>.Cipher.getInstance(<span class="string">"RSA"</span>)</span><br><span class="line">            <span class="number">2</span>.init(mode, key)</span><br><span class="line">            <span class="number">3</span>.cipher.doFinal()</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub  </span></span><br><span class="line">        HashMap&lt;String, Object&gt; map = RSAUtils.getKeys();  </span><br><span class="line">        <span class="comment">//生成公钥和私钥  </span></span><br><span class="line">        RSAPublicKey publicKey = (RSAPublicKey) map.get(<span class="string">"public"</span>);  </span><br><span class="line">        RSAPrivateKey privateKey = (RSAPrivateKey) map.get(<span class="string">"private"</span>);  </span><br><span class="line">          </span><br><span class="line">        <span class="comment">//模  </span></span><br><span class="line">        String modulus = publicKey.getModulus().toString();  </span><br><span class="line">        <span class="comment">//公钥指数  </span></span><br><span class="line">        String public_exponent = publicKey.getPublicExponent().toString();  </span><br><span class="line">        <span class="comment">//私钥指数  </span></span><br><span class="line">        String private_exponent = privateKey.getPrivateExponent().toString();  </span><br><span class="line">        <span class="comment">//明文  </span></span><br><span class="line">        String ming = <span class="string">"123456789"</span>;  </span><br><span class="line">        <span class="comment">//使用模和指数生成公钥和私钥  </span></span><br><span class="line">        RSAPublicKey pubKey = RSAUtils.getPublicKey(modulus, public_exponent);  </span><br><span class="line">        RSAPrivateKey priKey = RSAUtils.getPrivateKey(modulus, private_exponent);  </span><br><span class="line">        <span class="comment">//加密后的密文  </span></span><br><span class="line">        String mi = RSAUtils.encryptByPublicKey(ming, pubKey);  </span><br><span class="line">        System.err.println(mi);  </span><br><span class="line">        <span class="comment">//解密后的明文  </span></span><br><span class="line">        ming = RSAUtils.decryptByPrivateKey(mi, priKey);  </span><br><span class="line">        System.err.println(ming);  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>RSAUtils.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RSAUtils</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 生成公钥和私钥 </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NoSuchAlgorithmException  </span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HashMap&lt;String, Object&gt; <span class="title">getKeys</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchAlgorithmException</span>&#123;  </span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();  </span><br><span class="line">        KeyPairGenerator keyPairGen = KeyPairGenerator.getInstance(<span class="string">"RSA"</span>);  </span><br><span class="line">        keyPairGen.initialize(<span class="number">1024</span>);  </span><br><span class="line">        KeyPair keyPair = keyPairGen.generateKeyPair();  </span><br><span class="line">        RSAPublicKey publicKey = (RSAPublicKey) keyPair.getPublic();  </span><br><span class="line">        RSAPrivateKey privateKey = (RSAPrivateKey) keyPair.getPrivate();  </span><br><span class="line">        map.put(<span class="string">"public"</span>, publicKey);  </span><br><span class="line">        map.put(<span class="string">"private"</span>, privateKey);  </span><br><span class="line">        <span class="keyword">return</span> map;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 使用模和指数生成RSA公钥 </span></span><br><span class="line"><span class="comment">     * 注意：【此代码用了默认补位方式，为RSA/None/PKCS1Padding，不同JDK默认的补位方式可能不同，如Android默认是RSA </span></span><br><span class="line"><span class="comment">     * /None/NoPadding】 </span></span><br><span class="line"><span class="comment">     *  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> modulus </span></span><br><span class="line"><span class="comment">     *            模 </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> exponent </span></span><br><span class="line"><span class="comment">     *            指数 </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RSAPublicKey <span class="title">getPublicKey</span><span class="params">(String modulus, String exponent)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            BigInteger b1 = <span class="keyword">new</span> BigInteger(modulus);  </span><br><span class="line">            BigInteger b2 = <span class="keyword">new</span> BigInteger(exponent);  </span><br><span class="line">            KeyFactory keyFactory = KeyFactory.getInstance(<span class="string">"RSA"</span>);  </span><br><span class="line">            RSAPublicKeySpec keySpec = <span class="keyword">new</span> RSAPublicKeySpec(b1, b2);  </span><br><span class="line">            <span class="keyword">return</span> (RSAPublicKey) keyFactory.generatePublic(keySpec);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 使用模和指数生成RSA私钥 </span></span><br><span class="line"><span class="comment">     * 注意：【此代码用了默认补位方式，为RSA/None/PKCS1Padding，不同JDK默认的补位方式可能不同，如Android默认是RSA </span></span><br><span class="line"><span class="comment">     * /None/NoPadding】 </span></span><br><span class="line"><span class="comment">     *  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> modulus </span></span><br><span class="line"><span class="comment">     *            模 </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> exponent </span></span><br><span class="line"><span class="comment">     *            指数 </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RSAPrivateKey <span class="title">getPrivateKey</span><span class="params">(String modulus, String exponent)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            BigInteger b1 = <span class="keyword">new</span> BigInteger(modulus);  </span><br><span class="line">            BigInteger b2 = <span class="keyword">new</span> BigInteger(exponent);  </span><br><span class="line">            KeyFactory keyFactory = KeyFactory.getInstance(<span class="string">"RSA"</span>);  </span><br><span class="line">            RSAPrivateKeySpec keySpec = <span class="keyword">new</span> RSAPrivateKeySpec(b1, b2);  </span><br><span class="line">            <span class="keyword">return</span> (RSAPrivateKey) keyFactory.generatePrivate(keySpec);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 公钥加密 </span></span><br><span class="line"><span class="comment">     *  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> publicKey </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">encryptByPublicKey</span><span class="params">(String data, RSAPublicKey publicKey)</span>  </span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">        Cipher cipher = Cipher.getInstance(<span class="string">"RSA"</span>);  </span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, publicKey);  </span><br><span class="line">        <span class="comment">// 模长  </span></span><br><span class="line">        <span class="keyword">int</span> key_len = publicKey.getModulus().bitLength() / <span class="number">8</span>;  </span><br><span class="line">        <span class="comment">// 加密数据长度 &lt;= 模长-11  </span></span><br><span class="line">        String[] datas = splitString(data, key_len - <span class="number">11</span>);  </span><br><span class="line">        String mi = <span class="string">""</span>;  </span><br><span class="line">        <span class="comment">//如果明文长度大于模长-11则要分组加密  </span></span><br><span class="line">        <span class="keyword">for</span> (String s : datas) &#123;  </span><br><span class="line">            mi += bcd2Str(cipher.doFinal(s.getBytes()));  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> mi;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 私钥解密 </span></span><br><span class="line"><span class="comment">     *  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> privateKey </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">decryptByPrivateKey</span><span class="params">(String data, RSAPrivateKey privateKey)</span>  </span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">        Cipher cipher = Cipher.getInstance(<span class="string">"RSA"</span>);  </span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, privateKey);  </span><br><span class="line">        <span class="comment">//模长  </span></span><br><span class="line">        <span class="keyword">int</span> key_len = privateKey.getModulus().bitLength() / <span class="number">8</span>;  </span><br><span class="line">        <span class="keyword">byte</span>[] bytes = data.getBytes();  </span><br><span class="line">        <span class="keyword">byte</span>[] bcd = ASCII_To_BCD(bytes, bytes.length);  </span><br><span class="line">        System.err.println(bcd.length);  </span><br><span class="line">        <span class="comment">//如果密文长度大于模长则要分组解密  </span></span><br><span class="line">        String ming = <span class="string">""</span>;  </span><br><span class="line">        <span class="keyword">byte</span>[][] arrays = splitArray(bcd, key_len);  </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">byte</span>[] arr : arrays)&#123;  </span><br><span class="line">            ming += <span class="keyword">new</span> String(cipher.doFinal(arr));  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> ming;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * ASCII码转BCD码 </span></span><br><span class="line"><span class="comment">     *  </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] ASCII_To_BCD(<span class="keyword">byte</span>[] ascii, <span class="keyword">int</span> asc_len) &#123;  </span><br><span class="line">        <span class="keyword">byte</span>[] bcd = <span class="keyword">new</span> <span class="keyword">byte</span>[asc_len / <span class="number">2</span>];  </span><br><span class="line">        <span class="keyword">int</span> j = <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; (asc_len + <span class="number">1</span>) / <span class="number">2</span>; i++) &#123;  </span><br><span class="line">            bcd[i] = asc_to_bcd(ascii[j++]);  </span><br><span class="line">            bcd[i] = (<span class="keyword">byte</span>) (((j &gt;= asc_len) ? <span class="number">0x00</span> : asc_to_bcd(ascii[j++])) + (bcd[i] &lt;&lt; <span class="number">4</span>));  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> bcd;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span> <span class="title">asc_to_bcd</span><span class="params">(<span class="keyword">byte</span> asc)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">byte</span> bcd;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> ((asc &gt;= <span class="string">'0'</span>) &amp;&amp; (asc &lt;= <span class="string">'9'</span>))  </span><br><span class="line">            bcd = (<span class="keyword">byte</span>) (asc - <span class="string">'0'</span>);  </span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((asc &gt;= <span class="string">'A'</span>) &amp;&amp; (asc &lt;= <span class="string">'F'</span>))  </span><br><span class="line">            bcd = (<span class="keyword">byte</span>) (asc - <span class="string">'A'</span> + <span class="number">10</span>);  </span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((asc &gt;= <span class="string">'a'</span>) &amp;&amp; (asc &lt;= <span class="string">'f'</span>))  </span><br><span class="line">            bcd = (<span class="keyword">byte</span>) (asc - <span class="string">'a'</span> + <span class="number">10</span>);  </span><br><span class="line">        <span class="keyword">else</span>  </span><br><span class="line">            bcd = (<span class="keyword">byte</span>) (asc - <span class="number">48</span>);  </span><br><span class="line">        <span class="keyword">return</span> bcd;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * BCD转字符串 </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">bcd2Str</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">char</span> temp[] = <span class="keyword">new</span> <span class="keyword">char</span>[bytes.length * <span class="number">2</span>], val;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; bytes.length; i++) &#123;  </span><br><span class="line">            val = (<span class="keyword">char</span>) (((bytes[i] &amp; <span class="number">0xf0</span>) &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0x0f</span>);  </span><br><span class="line">            temp[i * <span class="number">2</span>] = (<span class="keyword">char</span>) (val &gt; <span class="number">9</span> ? val + <span class="string">'A'</span> - <span class="number">10</span> : val + <span class="string">'0'</span>);  </span><br><span class="line">  </span><br><span class="line">            val = (<span class="keyword">char</span>) (bytes[i] &amp; <span class="number">0x0f</span>);  </span><br><span class="line">            temp[i * <span class="number">2</span> + <span class="number">1</span>] = (<span class="keyword">char</span>) (val &gt; <span class="number">9</span> ? val + <span class="string">'A'</span> - <span class="number">10</span> : val + <span class="string">'0'</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String(temp);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 拆分字符串 </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String[] splitString(String string, <span class="keyword">int</span> len) &#123;  </span><br><span class="line">        <span class="keyword">int</span> x = string.length() / len;  </span><br><span class="line">        <span class="keyword">int</span> y = string.length() % len;  </span><br><span class="line">        <span class="keyword">int</span> z = <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">if</span> (y != <span class="number">0</span>) &#123;  </span><br><span class="line">            z = <span class="number">1</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        String[] strings = <span class="keyword">new</span> String[x + z];  </span><br><span class="line">        String str = <span class="string">""</span>;  </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;x+z; i++) &#123;  </span><br><span class="line">            <span class="keyword">if</span> (i==x+z-<span class="number">1</span> &amp;&amp; y!=<span class="number">0</span>) &#123;  </span><br><span class="line">                str = string.substring(i*len, i*len+y);  </span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">                str = string.substring(i*len, i*len+len);  </span><br><span class="line">            &#125;  </span><br><span class="line">            strings[i] = str;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> strings;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     *拆分数组  </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[][] splitArray(<span class="keyword">byte</span>[] data,<span class="keyword">int</span> len)&#123;  </span><br><span class="line">        <span class="keyword">int</span> x = data.length / len;  </span><br><span class="line">        <span class="keyword">int</span> y = data.length % len;  </span><br><span class="line">        <span class="keyword">int</span> z = <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">if</span>(y!=<span class="number">0</span>)&#123;  </span><br><span class="line">            z = <span class="number">1</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">byte</span>[][] arrays = <span class="keyword">new</span> <span class="keyword">byte</span>[x+z][];  </span><br><span class="line">        <span class="keyword">byte</span>[] arr;  </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;x+z; i++)&#123;  </span><br><span class="line">            arr = <span class="keyword">new</span> <span class="keyword">byte</span>[len];  </span><br><span class="line">            <span class="keyword">if</span>(i==x+z-<span class="number">1</span> &amp;&amp; y!=<span class="number">0</span>)&#123;  </span><br><span class="line">                System.arraycopy(data, i*len, arr, <span class="number">0</span>, y);  </span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">                System.arraycopy(data, i*len, arr, <span class="number">0</span>, len);  </span><br><span class="line">            &#125;  </span><br><span class="line">            arrays[i] = arr;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> arrays;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-4-问题"><a href="#2-4-问题" class="headerlink" title="2.4 问题"></a>2.4 问题</h5><blockquote>
<p>公钥(n,e) 只能 加密小于 n 的整数 m ，那么如果要加密大于 n 的整数，怎么办？<br>在 Java 中 进行 RSA 加密时，有 一个 错误为 ArrayIndexOutOfBoundsException: too much data for RSA block<br>该错误就是加密数据过长导致的。</p>
</blockquote>
<p>这里涉及到几个知识点 – <strong>密钥长度/密文长度/明文长度</strong></p>
<ol>
<li>明文长度<br> 明文长度(bytes) <strong>&lt;</strong>= 密钥长度(bytes)-11.<br> 如果 明文长度 大于 规定，则出现上述的问题，可以按照下文中的解决方法处理</li>
<li>密钥长度<br> 下限是96bits(12bytes)<br> 上限未知。不过目前为止，被破解的最长的密钥长度 为 768位，所以 1024 位基本安全， 2048 位绝对安全</li>
<li>密文长度<ul>
<li>不分片加密 – 密文长度 == 密钥长度</li>
<li>分片加密– 密文长度 == 密钥长度<em>分片数<br>  例如 明文 8 bytes , 密钥 128 bits<br>  每片明文长度 = 128/8 - 11 = 5 bytes<br>  分片数 = 8/5 +1 = 2<br>  密文长度 = 128/8 </em> 2 = 32 bytes</li>
</ul>
</li>
</ol>
<p><strong>解决方法</strong></p>
<ol>
<li>分片加密 – 是把长信息分割成若干段短消息，每段分别加密；</li>
<li>先选择一种”对称性加密算法”（比如DES），用这种算法的密钥加密信息，再用RSA公钥加密DES密钥。</li>
</ol>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="1-DES-详细加密过程"><a href="#1-DES-详细加密过程" class="headerlink" title="1. DES 详细加密过程"></a>1. DES 详细加密过程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">1. **对输入的密钥进行变换**。</span><br><span class="line">    用户的64bit密钥，其中第8， 16， 24， 32， 40， 48， 56， 64位是校验位， 使得每个密钥都有奇数个1。所以密钥事实上是56位。对这56位密钥进行如下表的换位。</span><br><span class="line"></span><br><span class="line">57, 49, 41, 33, 25, 17,   9,  1, 58, 50, 42, 34, 26, 18, 10,  2, 59, 51, 43, 35, 27, 19, 11,  3, 60, 52, 44, 36, </span><br><span class="line">63, 55, 47, 39, 31, 23, 15,  7, 62, 54, 46, 38, 30, 22, 14,  6, 61, 53, 45, 37, 29, 21, 13,  5, 28, 20, 12,   4,</span><br><span class="line"></span><br><span class="line">表的意思是第57位移到第1位，第49位移到第2位，...... 以此类推。变换后得到56bit数据，将它分成两部分，C[0][28], D[0][28]。</span><br><span class="line"></span><br><span class="line">2. **计算16个子密钥**，计算方法C[i][28] D[i][28]为对前一个C[i-1][28], D[i-1][28]做循环左移操作。16次的左移位数如下表:</span><br><span class="line"></span><br><span class="line"> 1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16   （第i次)</span><br><span class="line"> 1,  1,  2,  2,  2,  2,  2,  2,  1,  2,  2,  2,  2,  2,  2,  1    (左移位数)</span><br><span class="line"></span><br><span class="line">3. **串联**计算出来的C[i][28] D[i][28] 得到56位，然后对它进行如下变换得到48位子密钥K[i][48]</span><br><span class="line"></span><br><span class="line">14, 17, 11, 24,  1,  5,  3, 28, 15,  6, 21, 10, 23, 19, 12,  4, 26,  8, 16,  7, 27, 20, 13,  2,</span><br><span class="line">41, 52, 31, 37, 47, 55, 30, 40, 51, 45, 33, 48, 44, 49, 39, 56, 34, 53, 46, 42, 50, 36, 29, 32,</span><br><span class="line"></span><br><span class="line">表的意思是第14位移到第1位，第17位移到第2位，以此类推。在此过程中，发现第9，18，22，25， 35，38，43，54位丢弃。</span><br><span class="line"></span><br><span class="line">4. 对64bit的明文输入进行换位变换。换位表如下:</span><br><span class="line"></span><br><span class="line">58, 50, 12, 34, 26, 18, 10,  2, 60, 52, 44, 36, 28, 20, 12,  4,</span><br><span class="line">62, 54, 46, 38, 30, 22, 14,  6, 64, 56, 48, 40, 32, 24, 16,  8,</span><br><span class="line">57, 49, 41, 33, 25, 17,   9,  1, 59, 51, 43, 35, 27, 19, 11,  3,</span><br><span class="line">61, 53, 45, 37, 29, 21, 13,  5, 63, 55, 47, 39, 31, 23, 15,  7</span><br><span class="line"></span><br><span class="line">表的意思就是第一次变换时，第58位移到第1位，第50位移到第2位，...... 依此类推。得到64位数据，将这数据前后分成两块L[0][32], R[0][32]。</span><br><span class="line"></span><br><span class="line">5. 加密过程，对R[i][32]进行扩展变换成48位数，方法如下， 记为E(R[i][32])</span><br><span class="line"></span><br><span class="line">32,  1,  2,  3,  4,  5,   </span><br><span class="line"> 4,  5,  6,  7,  8,  9,</span><br><span class="line"> 8,  9, 10, 11, 12, 13, </span><br><span class="line">12, 13, 14, 15, 16, 17,</span><br><span class="line">16, 17, 18, 19, 20, 21,</span><br><span class="line">20, 21, 22, 23, 24, 25, </span><br><span class="line">24, 25, 26, 27, 28, 29,</span><br><span class="line">28, 29, 30, 31, 32,  1,</span><br><span class="line"></span><br><span class="line">6. 将E(R[i][32])与K[i][48]作异或运算，得到48位数，将48位数顺序分成8份，6位一份，B[8][6]。</span><br><span class="line"></span><br><span class="line">7. 使用S[i]替换B[i][6]。过程如下: 取出B[i][6]的第1位和第6位连成一个2位数m， m就是S[i]中对应的行数(0-3)，取出B[i][6]的第2到第5位连成一个4位数n(0-15)，n就是S[i]中对应的列数，用S[i][m][n]代替B[i][6]。S是4行16列的对应表，里面是4位的数，一共有8个S，定义如下:</span><br><span class="line"></span><br><span class="line">S[1]:</span><br><span class="line">   14,4,13,1,2,15,11,8,3,10,6,12,5,9,0,7, </span><br><span class="line">　　0,15,7,4,14,2,13,1,10,6,12,11,9,5,3,8, </span><br><span class="line">　　4,1,14,8,13,6,2,11,15,12,9,7,3,10,5,0, </span><br><span class="line">　　15,12,8,2,4,9,1,7,5,11,3,14,10,0,6,13,</span><br><span class="line">S[2]:</span><br><span class="line">    15,1,8,14,6,11,3,4,9,7,2,13,12,0,5,10, </span><br><span class="line">    3,13,4,7,15,2,8,14,12,0,1,10,6,9,11,5, </span><br><span class="line">    0,14,7,11,10,4,13,1,5,8,12,6,9,3,2,15, </span><br><span class="line">    13,8,10,1,3,15,4,2,11,6,7,12,0,5,14,9,</span><br><span class="line">S[3]:</span><br><span class="line">    10,0,9,14,6,3,15,5,1,13,12,7,11,4,2,8, </span><br><span class="line">    13,7,0,9,3,4,6,10,2,8,5,14,12,11,15,1, </span><br><span class="line">    13,6,4,9,8,15,3,0,11,1,2,12,5,10,14,7, </span><br><span class="line">    1,10,13,0,6,9,8,7,4,15,14,3,11,5,2,12,</span><br><span class="line">S[4]:</span><br><span class="line">    7,13,14,3,0,6,9,10,1,2,8,5,11,12,4,15, </span><br><span class="line">　　13,8,11,5,6,15,0,3,4,7,2,12,1,10,14,9, </span><br><span class="line">　　10,6,9,0,12,11,7,13,15,1,3,14,5,2,8,4, </span><br><span class="line">　　3,15,0,6,10,1,13,8,9,4,5,11,12,7,2,14, </span><br><span class="line">S[5]: </span><br><span class="line">　　2,12,4,1,7,10,11,6,8,5,3,15,13,0,14,9, </span><br><span class="line">　　14,11,2,12,4,7,13,1,5,0,15,10,3,9,8,6, </span><br><span class="line">　　4,2,1,11,10,13,7,8,15,9,12,5,6,3,0,14, </span><br><span class="line">　　11,8,12,7,1,14,2,13,6,15,0,9,10,4,5,3, </span><br><span class="line">S[6]: </span><br><span class="line">　　12,1,10,15,9,2,6,8,0,13,3,4,14,7,5,11, </span><br><span class="line">　　10,15,4,2,7,12,9,5,6,1,13,14,0,11,3,8, </span><br><span class="line">　　9,14,15,5,2,8,12,3,7,0,4,10,1,13,11,6, </span><br><span class="line">　　4,3,2,12,9,5,15,10,11,14,1,7,6,0,8,13, </span><br><span class="line">S[7]: </span><br><span class="line">　　4,11,2,14,15,0,8,13,3,12,9,7,5,10,6,1, </span><br><span class="line">　　13,0,11,7,4,9,1,10,14,3,5,12,2,15,8,6, </span><br><span class="line">　　1,4,11,13,12,3,7,14,10,15,6,8,0,5,9,2, </span><br><span class="line">　　6,11,13,8,1,4,10,7,9,5,0,15,14,2,3,12, </span><br><span class="line">S[8]: </span><br><span class="line">　　13,2,8,4,6,15,11,1,10,9,3,14,5,0,12,7, </span><br><span class="line">　　1,15,13,8,10,3,7,4,12,5,6,11,0,14,9,2, </span><br><span class="line">　　7,11,4,1,9,12,14,2,0,6,10,13,15,3,5,8, </span><br><span class="line">　　2,1,14,7,4,10,8,13,15,12,9,0,3,5,6,11,</span><br><span class="line"></span><br><span class="line">8. 将从B[i][6]经过S得到的8个4位数连起来得到32位数。对这个数进行如下变换:</span><br><span class="line"></span><br><span class="line">   16,7,20,21,29,12,28,17, 1,15,23,26, 5,18,31,10, </span><br><span class="line">　　2,8,24,14,32,27, 3, 9,19,13,30, 6,22,11, 4,25,</span><br><span class="line"></span><br><span class="line">  得到的结果与L[i][32]作异或运算，把结果赋给R[i][32]。</span><br><span class="line"></span><br><span class="line">9. 把R[i-1][32]的值赋给L[i]，从5开始循环。直到K[16][48]结束。</span><br><span class="line"></span><br><span class="line">10. 将最后的L,R合并成64位，然后进行如下转化得到最后的结果。这是对第4步的一个逆变化。</span><br><span class="line"> 40, 8, 48, 16, 56, 24, 64, 32, </span><br><span class="line"> 39, 7, 47, 15, 55, 23, 63, 31, </span><br><span class="line"> 38, 6, 46, 14, 54, 22, 62, 30, </span><br><span class="line"> 37, 5, 45, 13, 53, 21, 61, 29, </span><br><span class="line"> 36, 4, 44, 12, 52, 20, 60, 28,</span><br><span class="line"> 35, 3, 43, 11, 51, 19, 59, 27, </span><br><span class="line"> 34, 2, 42, 10, 50, 18, 58, 26, </span><br><span class="line"> 33, 1, 41,   9, 49, 17, 57, 25</span><br></pre></td></tr></table></figure>
<h3 id="2-https-的加密算法"><a href="#2-https-的加密算法" class="headerlink" title="2. https 的加密算法"></a>2. https 的加密算法</h3><blockquote>
<p>由于之前看过 https 是 由 secure socket layer 实现的。 也是通过 公钥私钥 保证其安全性，所以在学习这篇文章的时候，就想 https 是由哪种 加密算法 做为其 底层实现的呢。 因此，就有了下面这部分。</p>
</blockquote>
<blockquote>
<p>关于 https 与 http 的区别 请看我的这篇博客，不再赘述。<a href="https://3dot141.cn/blogs/28952.html" target="_blank" rel="noopener">网络基础知识</a></p>
</blockquote>
<p><strong>原理：</strong></p>
<ul>
<li>浏览器把自身支持的一系列Cipher Suite（密钥算法套件，后文简称Cipher）[C1,C2,C3, …]发给服务器；</li>
<li>服务器接收到浏览器的所有Cipher后，与自己支持的套件作对比，如果找到双方都支持的Cipher，则告知浏览器；</li>
<li>浏览器与服务器使用匹配的Cipher进行后续通信。如果服务器没有找到匹配的算法，浏览器（以 Chrome 56为例）将给出错误信息:</li>
</ul>
<p>下面讲一下如何分析。</p>
<ol>
<li>准备： 通过可以抓取网络包的工具，这里通过 Wireshark 分析。<a href="http://www.cnblogs.com/tankxiao/archive/2012/10/10/2711777.html" target="_blank" rel="noopener">关于wireshark 的介绍请点击这里</a>.查看浏览器发送给服务器的 Ciper服务器的 Ciper</li>
<li>流程： <ul>
<li>浏览器首先发起握手协议， 一个’Client Hello’消息，如下图，按照Protocol协议顺序排序，然后，找到Client Hello，选中，依次查找 ‘Secure Sockets Layer’ -&gt; TLSv1.2 Record Layer -&gt; Handshake protocal -&gt;Ciper Suites.<img src="http://ovmspkp0s.bkt.clouddn.com/201711110701_362.png" alt=""></li>
<li>可以看到， Cipher有很多。总共16，第一个是Cipher Suite: TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 (0xc02b)。<img src="http://ovmspkp0s.bkt.clouddn.com/201711110709_795.png" alt=""></li>
<li>如果按照顺序继续寻找第一个 Info 为’Sever Hello’ 的报文，可以找到相应的Cipher Suite: TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 (0xc02b) 。<img src="http://ovmspkp0s.bkt.clouddn.com/201711110713_718.png" alt="">.</li>
</ul>
</li>
<li>Cipher介绍：<ul>
<li><strong>密钥交换算法</strong>，用于决定客户端与服务器之间在握手的过程中如何认证，用到的算法包括RSA，Diffie-Hellman，ECDH，PSK等</li>
<li><strong>加密算法</strong>，用于加密消息流，该名称后通常会带有两个数字，分别表示密钥的长度和初始向量的长度，比如DES 56/56, RC2 56/128, RC4 128/128, AES 128/128, AES 256/256</li>
<li><strong>报文认证信息码</strong>（MAC）算法，用于创建报文摘要，确保消息的完整性（没有被篡改），算法包括MD5，SHA等。</li>
<li><strong>PRF（伪随机数函数）</strong>，用于生成“master secret”。</li>
<li><strong>TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 (0xc02b)</strong>:<ul>
<li>基于TLS协议</li>
<li>使用 ECDHE,ECDSA作为密钥交换算法</li>
<li>加密算法 AES(密钥与初始向量的长度为128)</li>
<li>MAC 算法 SHA</li>
</ul>
</li>
</ul>
</li>
<li>总结：<br>Client端密钥算法套件[C1,C2,C3],Server端密钥算法套件[C4,C2,C1,C3]，<br>则，IIS<a href="">(Internet Infomation Services)</a>，C2将被优先返回</li>
</ol>
<hr>
<h3 id="3-wireshark-的使用问题"><a href="#3-wireshark-的使用问题" class="headerlink" title="3. wireshark 的使用问题"></a>3. wireshark 的使用问题</h3><p>问题:第一次使用 wireshark 的时候，不显示接口。原因是。。。<br>刚开始使用 在windows 上需要 winpacp 并且开启 npf 服务。<br>注： 如果 没有安装 winpacp ，想直接 通过 net start npf 开启服务，将会提示。 发生系统错误2</p>
<ol>
<li>winpacp 安装 。。。<br><a href="https://www.winpcap.org/install/" target="_blank" rel="noopener">这里是下载网站</a><br>直接安装即可。</li>
<li>开启 npf 服务<br>打开 cmd ,输入 <code>net start npf</code> ,提示：服务已经启动。</li>
<li>进入界面，选择相应的网卡。<br><img src="http://ovmspkp0s.bkt.clouddn.com/201711101750_461.png" alt=""><br>这里，可以通过 网络连接 看出来。<br><img src="http://ovmspkp0s.bkt.clouddn.com/201711101754_590.png" alt=""><br>所以，我的是无线网络连接。</li>
<li>最终界面<br><img src="http://ovmspkp0s.bkt.clouddn.com/201711101753_329.png" alt=""><br>WireShark 主要分为这几个界面</li>
<li>Display Filter(显示过滤器)，  用于过滤</li>
<li>Packet List Pane(封包列表)， 显示捕获到的封包， 有源地址和目标地址，端口号。 颜色不同，代表</li>
<li>Packet Details Pane(封包详细信息), 显示封包中的字段</li>
<li>Dissector Pane(16进制数据)</li>
<li>Miscellanous(地址栏，杂项)</li>
</ol>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>都看到这里了，点个<strong>关注</strong>,点波<strong>赞</strong>再走，QAQ。<br>你的小手<strong>轻点</strong>，是我最大的动力哦。</p>
<blockquote>
<p>一只想当程序员的1米88<strong>处女座</strong>大可爱<strong>如此说</strong>。</p>
</blockquote>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a href="http://blog.csdn.net/fenghao_5555/article/details/1589464" target="_blank" rel="noopener">DES 加密算法解析</a></li>
<li><a href="http://blog.csdn.net/fw0124/article/details/8472560" target="_blank" rel="noopener">分组加密的四种模式</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2013/07/rsa_algorithm_part_two.html" target="_blank" rel="noopener">阮一峰–RSA算法原理</a></li>
<li><a href="http://blog.csdn.net/centralperk/article/details/8558678" target="_blank" rel="noopener">java中RSA加解密的实现</a></li>
<li><a href="http://blog.sina.com.cn/s/blog_76550fd7010147tp.html" target="_blank" rel="noopener">关于RSA算法密钥长度/密文长度/明文长度</a></li>
<li><a href="http://kb.cnblogs.com/page/530044/" target="_blank" rel="noopener">https背后的加密算法</a></li>
</ol>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/killBase/" rel="tag"># killBase</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/blogs/28952.html" rel="next" title="逐梦offer -- 网络基础知识总结">
                <i class="fa fa-chevron-left"></i> 逐梦offer -- 网络基础知识总结
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/blogs/10580.html" rel="prev" title="killJtools -- Maven 入门详解">
                killJtools -- Maven 入门详解 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="3Dot141">
            
              <p class="site-author-name" itemprop="name">3Dot141</p>
              <p class="site-description motion-element" itemprop="description">Nothing is impossible to a willing heart.</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives">
                
                    <span class="site-state-item-count">67</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">5</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">12</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/3Dot141" title="GitHub &rarr; https://github.com/3Dot141" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://segmentfault.com/u/allen233" title="Segmentfault &rarr; https://segmentfault.com/u/allen233" rel="noopener" target="_blank"><i class="fa fa-fw fa-fire"></i>Segmentfault</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://juejin.im/user/57e5ce4c128fe10057fe296e" title="Juejin &rarr; https://juejin.im/user/57e5ce4c128fe10057fe296e" rel="noopener" target="_blank"><i class="fa fa-fw fa-circle"></i>Juejin</a>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://tech.meituan.com" title="https://tech.meituan.com" rel="noopener" target="_blank">美团点评技术团队</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#密码学"><span class="nav-text">密码学</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一、基础"><span class="nav-text">一、基础</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二、Base64-算法"><span class="nav-text">二、Base64 算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三、消息摘要"><span class="nav-text">三、消息摘要</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-MD5算法"><span class="nav-text">1. MD5算法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-SHA-算法"><span class="nav-text">2. SHA 算法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-HMAC-算法"><span class="nav-text">3. HMAC 算法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-SHA-与-MD5比较"><span class="nav-text">4. SHA 与 MD5比较</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#四、对称加密"><span class="nav-text">四、对称加密</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-DES-Data-Encryption-Standard"><span class="nav-text">1. DES(Data Encryption Standard)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1、-介绍："><span class="nav-text">1、 介绍：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2、-加密过程："><span class="nav-text">2、 加密过程：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3、-解密过程"><span class="nav-text">3、 解密过程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4、流程如图："><span class="nav-text">4、流程如图：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5、注意："><span class="nav-text">5、注意：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6、3DES"><span class="nav-text">6、3DES</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7、Java-实现"><span class="nav-text">7、Java 实现</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-AES-Advanced-Encryption-Standard"><span class="nav-text">2. AES(Advanced  Encryption Standard)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#五、非对称加密"><span class="nav-text">五、非对称加密</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-基础"><span class="nav-text">1. 基础</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-RSA-算法"><span class="nav-text">2. RSA 算法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-过程"><span class="nav-text">2.1 过程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-RSA-算法的可靠性-与-破解"><span class="nav-text">2.2 RSA 算法的可靠性 与 破解</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-3-Java-实现"><span class="nav-text">2.3 Java 实现</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-4-问题"><span class="nav-text">2.4 问题</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#附录"><span class="nav-text">附录</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-DES-详细加密过程"><span class="nav-text">1. DES 详细加密过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-https-的加密算法"><span class="nav-text">2. https 的加密算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-wireshark-的使用问题"><span class="nav-text">3. wireshark 的使用问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#结语"><span class="nav-text">结语</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-text">参考</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 – <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">3Dot141</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Total count: </span>
    
    <span title="Total count">290k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
      <span class="post-meta-item-text">Many coffee &asymp;</span>
    
    <span title="Many coffee">8:04</span>
  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="Total Visitors">
      <i class="fa fa-free-code-camp"></i>
      hits : <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> ℃ <span>&nbsp; | &nbsp;</span>
    </span>
  

  

  
    <i class="fa fa-clock-o"></i>    
       <span id="sitetime"></span>
   <span id="year" style="display:none">2017</span> 
   <span id="month" style="display:none">09</span>   
   <span id="day" style="display:none">15</span>   
   <span id="hour" style="display:none">0</span>   
   <span id="minute" style="display:none">0</span>   
   <span id="second" style="display:none">0</span>   
	<script language="javascript">
	function siteTime(){        
		window.setTimeout("siteTime()", 1000);
		var seconds = 1000;
		var minutes = seconds * 60;
		var hours = minutes * 60;
		var days = hours * 24;
		var years = days * 365;
		var today = new Date();
		var todayYear = today.getFullYear();
		var todayMonth = today.getMonth()+1;
		var todayDate = today.getDate();
		var todayHour = today.getHours();
		var todayMinute = today.getMinutes();
		var todaySecond = today.getSeconds();
		/* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
		year - 作为date对象的年份，为4位年份值
		month - 0-11之间的整数，做为date对象的月份
		day - 1-31之间的整数，做为date对象的天数
		hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
		minutes - 0-59之间的整数，做为date对象的分钟数
		seconds - 0-59之间的整数，做为date对象的秒数
		microseconds - 0-999之间的整数，做为date对象的毫秒数 */        
		var year = document.getElementById("year").innerHTML;
		var month = document.getElementById("month").innerHTML;
		var day = document.getElementById("day").innerHTML;
		var hour = document.getElementById("hour").innerHTML;
		var minute = document.getElementById("minute").innerHTML;
		var second = document.getElementById("second").innerHTML;//北京时间2018-2-13 00:00:00
		var t1 = Date.UTC(year,month,day,hour,minute,second); 
		var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
		var diff = t2-t1;
		var diffYears = Math.floor(diff/years);
		var diffDays = Math.floor((diff/days)-diffYears*365);
		var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
		var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
		var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
		if(diffYears==0){
		document.getElementById("sitetime").innerHTML=" website has run  "/*+diffYears+" year "*/+diffDays+" days "+diffHours+" h "+diffMinutes+" min "+diffSeconds+" s";
		} else{
		document.getElementById("sitetime").innerHTML=" website has run  "+diffYears+" year "+diffDays+" days "+diffHours+" h "+diffMinutes+" min "+diffSeconds+" s";
		}
	}
	//siteTime(document.getElementById("year").innerHTML,document.getElementById("year").innerHTML,document.getElementById("year").innerHTML,document.getElementById("year").innerHTML,document.getElementById("year").innerHTML,0);
	siteTime();
	</script>
  
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script src="/js/src/utils.js?v=6.6.0"></script>

  <script src="/js/src/motion.js?v=6.6.0"></script>



  
  

  
  <script src="/js/src/scrollspy.js?v=6.6.0"></script>
<script src="/js/src/post-details.js?v=6.6.0"></script>



  


  <script src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  








  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>

  <script>
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: true,
        notify: true,
        appId: 'LzTKvYQQYUPQV0KpQNG7SYXz-gzGzoHsz',
        appKey: 'lfgXFgXY0mt2PJxr88qQIeks',
        placeholder: 'Just go go',
        avatar:'mm',
        meta:guest,
        pageSize:'10' || 10,
        visitor: true
    });
  </script>




  

  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  
  

  

  
  <script src="/js/src/js.cookie.js?v=6.6.0"></script>
  <script src="/js/src/scroll-cookie.js?v=6.6.0"></script>


  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap');
      $(e).after($wrap);
      $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text();
        }).toArray().join('\n');
        var ta = document.createElement('textarea');
        var range = document.createRange(); //For Chrome
        var sel = window.getSelection(); //For Chrome
        var yPosition = window.pageYOffset || document.documentElement.scrollTop;
        ta.style.top = yPosition + 'px'; //Prevent page scroll
        ta.style.position = 'absolute';
        ta.style.opacity = '0';
        ta.value = code;
        ta.textContent = code; //For FireFox
        ta.contentEditable = true;
        ta.readOnly = false;
        document.body.appendChild(ta);
        range.selectNode(ta);
        sel.removeAllRanges();
        sel.addRange(range);
        ta.setSelectionRange(0, code.length);
        var result = document.execCommand('copy');
        
        ta.blur(); //For iOS
        $(this).blur();
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn');
        setTimeout(function () {
          $b.text('Copy');
        }, 300);
      }).append(e);
    })
  </script>


  

</body>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
</html>
